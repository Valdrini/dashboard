<div class="dashboard-container">
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <h1 class="dashboard-title">Dashboard Overview</h1>
    <p class="dashboard-subtitle">Welcome back! Here's what's happening with your business today.</p>
  </div>

  <!-- Global Filters -->
  <div class="dashboard-filters card shadow-sm mb-4">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-12 col-md-6 col-lg-4">
          <label class="form-label fw-semibold">
            <i class="bi bi-calendar3 me-2"></i>Date Range
          </label>
          <select 
            class="form-select" 
            [(ngModel)]="dateRange" 
            (change)="onDateRangeChange()"
          >
            <option value="7d">Last 7 Days</option>
            <option value="30d">Last 30 Days</option>
            <option value="90d">Last 90 Days</option>
            <option value="1y">Last Year</option>
            <option value="all">All Time</option>
          </select>
        </div>
        <div class="col-12 col-md-6 col-lg-4">
          <label class="form-label fw-semibold">
            <i class="bi bi-search me-2"></i>Search
          </label>
          <div class="input-group">
            <input 
              type="text" 
              class="form-control" 
              placeholder="Search..."
              [(ngModel)]="searchTerm"
              (input)="onSearch()"
            >
            <span class="input-group-text">
              <i class="bi bi-funnel"></i>
            </span>
          </div>
        </div>
        <div class="col-12 col-md-6 col-lg-4 d-flex align-items-end">
          <button class="btn btn-outline-primary w-100">
            <i class="bi bi-download me-2"></i>Export Report
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Summary Stats Cards -->
  <div class="row g-4 mb-4">
    <!-- Total Revenue Card -->
    <div class="col-12 col-md-6 col-lg-3">
      <div class="stat-card stat-card-primary">
        <div class="stat-card-icon">
          <i class="bi bi-currency-dollar"></i>
        </div>
        <div class="stat-card-content">
          <h3 class="stat-card-title">Total Revenue</h3>
          <p class="stat-card-value">${{ getTotalRevenue() | number:'1.0-0' }}</p>
          <span class="stat-card-trend text-success">
            <i class="bi bi-arrow-up-circle"></i> +15%
          </span>
        </div>
      </div>
    </div>

    <!-- Active Users Card -->
    <div class="col-12 col-md-6 col-lg-3">
      <div class="stat-card stat-card-info">
        <div class="stat-card-icon">
          <i class="bi bi-people"></i>
        </div>
        <div class="stat-card-content">
          <h3 class="stat-card-title">Active Users</h3>
          <p class="stat-card-value">{{ getTotalUsers() | number }}</p>
          <span class="stat-card-trend text-success">
            <i class="bi bi-arrow-up-circle"></i> +8%
          </span>
        </div>
      </div>
    </div>

    <!-- Total Sessions Card -->
    <div class="col-12 col-md-6 col-lg-3">
      <div class="stat-card stat-card-success">
        <div class="stat-card-icon">
          <i class="bi bi-graph-up"></i>
        </div>
        <div class="stat-card-content">
          <h3 class="stat-card-title">Sessions</h3>
          <p class="stat-card-value">{{ getTotalSessions() | number }}</p>
          <span class="stat-card-trend text-success">
            <i class="bi bi-arrow-up-circle"></i> +12%
          </span>
        </div>
      </div>
    </div>

    <!-- Average Session Duration Card -->
    <div class="col-12 col-md-6 col-lg-3">
      <div class="stat-card stat-card-warning">
        <div class="stat-card-icon">
          <i class="bi bi-clock-history"></i>
        </div>
        <div class="stat-card-content">
          <h3 class="stat-card-title">Avg. Session</h3>
          <p class="stat-card-value">{{ getAvgSessionDuration() }} min</p>
          <span class="stat-card-trend text-danger">
            <i class="bi bi-arrow-down-circle"></i> -3%
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="row g-4 mb-4">
    <!-- Line Chart -->
    <div class="col-12 col-lg-8">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-white border-bottom">
          <h5 class="mb-0 fw-semibold">
            <i class="bi bi-graph-up me-2"></i>User Activity Over Time
          </h5>
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas #lineChart></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Pie Chart -->
    <div class="col-12 col-lg-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-white border-bottom">
          <h5 class="mb-0 fw-semibold">
            <i class="bi bi-pie-chart me-2"></i>Revenue by Product
          </h5>
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas #pieChart></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bar Chart -->
  <div class="row g-4 mb-4">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-white border-bottom">
          <h5 class="mb-0 fw-semibold">
            <i class="bi bi-bar-chart me-2"></i>Engagement by Platform
          </h5>
        </div>
        <div class="card-body">
          <div class="chart-container chart-container-large">
            <canvas #barChart></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Data Tables Section -->
  <div class="row g-4">
    <!-- User Activity Table with Sorting and Pagination -->
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-white border-bottom d-flex align-items-center justify-content-between">
          <h5 class="mb-0 fw-semibold">
            <i class="bi bi-calendar3 me-2"></i>User Activity Details
          </h5>
          <span class="badge bg-primary">{{ activity.length }} records</span>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0 align-middle">
              <thead class="table-light">
                <tr>
                  <th 
                    (click)="sortTable('date')" 
                    class="cursor-pointer"
                  >
                    Date
                    <i class="bi" [ngClass]="sortedColumn === 'date' ? 
                      (sortDirection === 'asc' ? 'bi-sort-up' : 'bi-sort-down') : 
                      'bi-arrow-down-up'"></i>
                  </th>
                  <th 
                    (click)="sortTable('activeUsers')" 
                    class="text-end cursor-pointer"
                  >
                    Active Users
                    <i class="bi" [ngClass]="sortedColumn === 'activeUsers' ? 
                      (sortDirection === 'asc' ? 'bi-sort-up' : 'bi-sort-down') : 
                      'bi-arrow-down-up'"></i>
                  </th>
                  <th 
                    (click)="sortTable('newUsers')" 
                    class="text-end cursor-pointer"
                  >
                    New Users
                    <i class="bi" [ngClass]="sortedColumn === 'newUsers' ? 
                      (sortDirection === 'asc' ? 'bi-sort-up' : 'bi-sort-down') : 
                      'bi-arrow-down-up'"></i>
                  </th>
                  <th 
                    (click)="sortTable('sessions')" 
                    class="text-end cursor-pointer"
                  >
                    Sessions
                    <i class="bi" [ngClass]="sortedColumn === 'sessions' ? 
                      (sortDirection === 'asc' ? 'bi-sort-up' : 'bi-sort-down') : 
                      'bi-arrow-down-up'"></i>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let r of paginatedActivity">
                  <td class="fw-medium">{{ r.date }}</td>
                  <td class="text-end">{{ r.activeUsers | number }}</td>
                  <td class="text-end">
                    <span class="badge bg-success-subtle text-success">{{ r.newUsers | number }}</span>
                  </td>
                  <td class="text-end">{{ r.sessions | number }}</td>
                </tr>
              </tbody>
            </table>
          </div>
          <!-- Pagination -->
          <div class="pagination-container p-3 border-top">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <small class="text-muted">
                  Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to 
                  {{ currentPage * itemsPerPage > activity.length ? activity.length : currentPage * itemsPerPage }} 
                  of {{ activity.length }} entries
                </small>
              </div>
              <div class="d-flex gap-2">
                <button 
                  class="btn btn-sm btn-outline-primary" 
                  (click)="goToPreviousPage()"
                  [disabled]="currentPage === 1"
                >
                  <i class="bi bi-chevron-left"></i> Previous
                </button>
                <div class="btn-group">
                  <button 
                    *ngFor="let page of pagesArray" 
                    class="btn btn-sm"
                    [class.btn-primary]="currentPage === page"
                    [class.btn-outline-primary]="currentPage !== page"
                    (click)="onPageChange(page)"
                  >
                    {{ page }}
                  </button>
                </div>
                <button 
                  class="btn btn-sm btn-outline-primary" 
                  (click)="goToNextPage()"
                  [disabled]="currentPage === totalPages"
                >
                  Next <i class="bi bi-chevron-right"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Engagement Table -->
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-white border-bottom d-flex align-items-center justify-content-between">
          <h5 class="mb-0 fw-semibold">
            <i class="bi bi-bar-chart me-2"></i>Engagement by Platform
          </h5>
          <span class="badge bg-info">{{ engagement.length }} platforms</span>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0 align-middle">
              <thead class="table-light">
                <tr>
                  <th>Platform</th>
                  <th class="text-end">Page Views</th>
                  <th class="text-end">Avg. Session</th>
                  <th class="text-end">Bounce Rate</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let r of engagement">
                  <td class="fw-medium">
                    <span class="badge bg-primary-subtle">{{ r.platform }}</span>
                  </td>
                  <td class="text-end">{{ r.pageViews | number }}</td>
                  <td class="text-end">{{ r.avgSessionDuration }} min</td>
                  <td class="text-end">
                    <span class="badge" [ngClass]="getBounceRateClass(r.bounceRate)">{{ r.bounceRate }}%</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Top Products Table -->
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-white border-bottom d-flex align-items-center justify-content-between">
          <h5 class="mb-0 fw-semibold">
            <i class="bi bi-box-seam me-2"></i>Top Products Performance
          </h5>
          <span class="badge bg-success">{{ products.length }} products</span>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0 align-middle">
              <thead class="table-light">
                <tr>
                  <th>Product</th>
                  <th class="text-end">Sales</th>
                  <th class="text-end">Revenue</th>
                  <th class="text-end">Revenue per Sale</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let r of products">
                  <td class="fw-medium">{{ r.product }}</td>
                  <td class="text-end">
                    <span class="badge bg-info-subtle text-info">{{ r.sales | number }}</span>
                  </td>
                  <td class="text-end fw-semibold">${{ r.revenue | number }}</td>
                  <td class="text-end">${{ (r.revenue / r.sales) | number:'1.0-0' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
